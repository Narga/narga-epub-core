@charset "utf-8";
@namespace epub url(http://www.idpf.org/2007/ops);

/* ================================================================
 * STYLESHEET EPUB MASTER - TƯƠNG THÍCH & ĐẦY ĐỦ TÍNH NĂNG
 * Phiên bản: 7.0 (Tối ưu hóa nâng cao)
 * Hợp nhất và cải tiến dựa trên các tiêu chuẩn EPUB 3,
 * đảm bảo tương thích ngược và tối ưu cho Kindle, Kobo.
 * ================================================================ */

/*
  1. THIẾT LẬP TOÀN CỤC, BIẾN & FONT
================================================================
*/

:root {
    /*
     * TỐI ƯU HÓA CHUỖI FONT (FONT STACK)
     * Chuỗi font này ưu tiên các font mặc định chất lượng cao của từng thiết bị.
     * 1. 'Bookerly': Font nhúng của bạn (nếu có).
     * 2. "Caecilia", "Bookerly": Font mặc định của Kindle.
     * 3. "Kobo Nickel": Font mặc định của Kobo.
     * 4. "Malabar", "Georgia": Các font serif thay thế phổ biến, chất lượng.
     * 5. "Times New Roman", Times, serif: Fallback cuối cùng, có mặt ở mọi nơi.
    */
    --font-main: 'Bookerly', "Caecilia", "Bookerly", "Kobo Nickel", "Malabar", Georgia, "Times New Roman", Times, serif;
    --font-mono: "Courier New", Courier, monospace;
    --color-border: #999;
    --color-border-dark: #555;
}

/*
 * KHAI BÁO FONT
 * GHI CHÚ VỀ ĐỊNH DẠNG FONT:
 * - Tương thích nhất: TTF / OTF (hoạt động trên mọi thiết bị, kể cả rất cũ).
 * - Tối ưu nhất (dung lượng nhỏ): WOFF2.
 * - Cân bằng nhất (khuyến nghị): WOFF (dung lượng nhỏ và tương thích rất rộng rãi).
 * -> Cấu trúc src bên dưới sẽ ưu tiên WOFF2 -> WOFF -> TTF, giúp thiết bị
 * tự chọn định dạng tốt nhất mà nó hỗ trợ.
*/
@font-face {
    font-family: 'Bookerly';
    font-weight: normal;
    font-style: normal;
    font-display: swap;
    src: url('../Fonts/Bookerly.woff2') format('woff2'),
         url('../Fonts/Bookerly.woff') format('woff'),
         url('../Fonts/Bookerly.ttf') format('truetype');
}

@font-face {
    font-family: 'Bookerly';
    font-weight: bold;
    font-style: normal;
    font-display: swap;
    src: url('../Fonts/Bookerly-Bold.woff2') format('woff2'),
         url('../Fonts/Bookerly-Bold.woff') format('woff'),
         url('../Fonts/Bookerly-Bold.ttf') format('truetype');
}

@font-face {
    font-family: 'Bookerly';
    font-weight: normal;
    font-style: italic;
    font-display: swap;
    src: url('../Fonts/Bookerly-Italic.woff2') format('woff2'),
         url('../Fonts/Bookerly-Italic.woff') format('woff'),
         url('../Fonts/Bookerly-Italic.ttf') format('truetype');
}

@font-face {
    font-family: 'Bookerly';
    font-weight: bold;
    font-style: italic;
    font-display: swap;
    src: url('../Fonts/Bookerly-BoldItalic.woff2') format('woff2'),
         url('../Fonts/Bookerly-BoldItalic.woff') format('woff'),
         url('../Fonts/Bookerly-BoldItalic.ttf') format('truetype');
}

/* THIẾT LẬP CƠ BẢN */
html {
    font-size: 100%;
}

body {
    font-family: var(--font-main);
    line-height: 1.5;
    widows: 2;
    orphans: 2;
    /* QUAN TRỌNG: Không đặt `margin` hay `padding` cho `body` để thiết bị tự quản lý lề ngoài.
       Đây là cách làm an toàn nhất để tránh lỗi lề kép (double margin) trên các thiết bị. */
    margin: 0;
    padding: 0;
}

/* Đảm bảo các thành phần HTML5 hiển thị dạng khối trên trình đọc EPUB 2 cũ */
article, aside, figure, figcaption, footer, header, main, nav, section {
    display: block;
}

/*
  2. ĐỊNH DẠNG VĂN BẢN (TYPOGRAPHY)
================================================================
*/

p {
    text-align: justify;
    text-indent: 1.5rem;
    margin: 0 0 1rem 0; /* Thêm khoảng cách dưới giữa các đoạn văn */
    padding: 0;
    -webkit-hyphens: auto;
    -epub-hyphens: auto;
    hyphens: auto;
}

/* Đoạn văn đầu tiên hoặc sau các yếu tố ngăn cách sẽ không thụt lề */
p:first-of-type,
h1+p, h2+p, h3+p, h4+p, blockquote+p, figure+p {
    text-indent: 0;
}

h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-main);
    line-height: 1.2;
    margin: 1.5rem 0 1rem 0;
    text-indent: 0;
    font-weight: bold;
    -webkit-hyphens: none;
    -epub-hyphens: none;
    hyphens: none;
    break-after: avoid;
    page-break-after: avoid; /* Fallback cho thiết bị cũ */
}

h1, h2, h3 { text-align: center; }
h1 { font-size: 2rem; }
h2 { font-size: 1.6rem; }
h3 { font-size: 1.3rem; }
h4 { font-size: 1.1rem; text-align: left;}
h5 { font-size: 1rem; text-align: left;}
h6 { font-size: 0.9rem; text-align: left;}

/*
  3. CÁC THÀNH PHẦN ĐẶC BIỆT (COMPONENTS)
================================================================
*/

/* ----- Trích dẫn (Blockquotes) ----- */
blockquote {
    margin: 1.5rem 2.5rem;
    font-style: italic;
}
blockquote p {
    margin-bottom: 0.5rem;
    text-indent: 0;
}
blockquote.border {
    padding-left: 1rem;
    margin-left: 1.5rem;
    border-left: 2px solid var(--color-border);
}

/* ----- Chữ cái lớn đầu dòng (Dropcaps) ----- */
.dropcap {
    /* Fallback cho máy đọc sách cũ */
    float: left;
    font-size: 3.5em;
    line-height: 0.8;
    margin: 0.1em 0.1em 0 0;
    font-weight: bold;
}
@supports (initial-letter: 3) or (-webkit-initial-letter: 3) {
    .dropcap {
        /* Phương pháp hiện đại, căn chỉnh hoàn hảo hơn */
        -webkit-initial-letter: 3;
        initial-letter: 3;
        margin-right: 0.2rem;
        float: none;
    }
}

/* ----- Hình ảnh & Chú thích ----- */
figure {
    display: block;
    margin: 1.5rem 0;
    padding: 0;
    break-inside: avoid;
    page-break-inside: avoid; /* Fallback */
}
img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}
figcaption, caption {
    display: block;
    font-size: 0.8rem;
    font-style: italic;
    text-align: center;
    margin: 0.5rem auto 0 auto;
    text-indent: 0;
}

/* ----- Bảng biểu ----- */
table {
    margin: 1.5rem auto;
    border-collapse: collapse;
    max-width: 100%;
    break-inside: avoid;
    page-break-inside: avoid; /* Fallback */
}
th, td {
    border: 1px solid var(--color-border);
    padding: 0.5rem;
    text-align: left;
    vertical-align: middle;
}

/* ----- Đường kẻ & Dấu ngăn cách ----- */
hr {
    border: 0;
    border-top: 1px solid currentColor;
    opacity: 0.5;
    width: 50%;
    margin: 2rem auto;
}

/* Dấu ngăn cách trang trí. Hoạt động tốt trên hầu hết các thiết bị,
   nhưng có thể không hiển thị trên Kindle rất cũ. */
.dots,
.ornament {
    border: 0;
    text-align: center;
    width: 100%;
    margin: 0.5rem auto; /* Khoảng cách trên dưới là 0.5em */
}
.dots::after {
    content: "▪ ▪ ▪";
    font-size: 1.2rem;
    letter-spacing: 0.5em;
    color: var(--color-border);
}
.ornament::after {
    content: "✽ ✽ ✽";
    font-size: 1.2rem;
    letter-spacing: 0.5em;
    color: var(--color-border);
}

/* ----- Trang căn giữa nội dung (Full Page Center) ----- */
/* Lớp này dùng để tạo một trang mà nội dung bên trong được căn chính giữa
   theo cả chiều ngang và chiều dọc. Lý tưởng cho trang bìa phụ, trích dẫn đặc biệt. */
.full-page-center {
    display: flex;
    justify-content: center; /* Căn giữa theo chiều ngang */
    align-items: center;    /* Căn giữa theo chiều dọc */
    min-height: 100vh;      /* Chiều cao tối thiểu bằng 100% chiều cao màn hình */
    text-align: center;     /* Căn giữa chữ cho các thẻ con */
    padding: 0 1rem;        /* Thêm padding nhẹ để nội dung không chạm sát viền */
    margin: 0;
    page-break-before: always; /* Luôn bắt đầu trên một trang mới */
}
/*
  4. ĐỊNH DẠNG INLINE & CÁC LỚP TIỆN ÍCH
================================================================
*/

/* ----- Thẻ HTML gốc ----- */
em, i, cite, var { font-style: italic; }
strong, b { font-weight: bold; }
u, ins { text-decoration: underline; }
s, strike, del { text-decoration: line-through; }
sup, a[epub|type="noteref"] { vertical-align: super; font-size: 0.75em; line-height: 1; }
sub { vertical-align: sub; font-size: 0.75em; line-height: 1; }
code, kbd, tt, samp { font-family: var(--font-mono); }

/* ----- Lớp tiện ích ----- */
.italic { font-style: italic; }
.bold { font-weight: bold; }
.underline { text-decoration: underline; }
.strikethrough { text-decoration: line-through; }
.monospace { font-family: var(--font-mono); }
.smallcaps { font-variant: small-caps; letter-spacing: 0.1em; }

.text-center { text-align: center !important; text-indent: 0 !important; }
.text-right { text-align: right !important; text-indent: 0 !important; }
.text-left { text-align: left !important; }
.no-indent { text-indent: 0 !important; }

/* Đảm bảo các thẻ <p> bên trong một khối được căn giữa cũng sẽ được căn giữa */
.text-center p {
    text-align: center !important;
    text-indent: 0 !important;
}

/* Tạo khoảng nghỉ giữa các đoạn văn, hữu ích cho việc ngắt cảnh */
.space-break {
    margin-top: 1rem;
    margin-bottom: 1rem;
}

/*
  5. LIÊN KẾT & NAVIGATION (EPUB 3)
================================================================
*/

a {
    text-decoration: none;
    color: inherit;
    /* Gợi ý: Để liên kết dễ nhận biết hơn, bạn có thể bật dòng dưới đây
    text-decoration: underline; */
}

/* Ẩn các mục lục không cần thiết trên trang đọc (Landmarks, Page List) */
nav[epub|type~="landmarks"],
nav[epub|type~="page-list"] {
    display: none;
}

/* Định dạng cơ bản cho mục lục trong sách (Table of Contents) */
nav[epub|type~="toc"] ol {
    list-style: none;
    padding: 0;
    margin: 0;
}
nav[epub|type~="toc"] li {
    margin: 0.5rem 0;
}